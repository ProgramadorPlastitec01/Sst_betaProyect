{% extends 'base.html' %}
{% load static %}

{% block title %}Detalles del Rol: {{ role.name }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h2><i class="fas fa-user-shield"></i> Detalles del Rol</h2>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <h3>{{ role.name }}</h3>
                    <p class="text-muted">{{ role.description }}</p>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Estado:</strong>
                            {% if role.is_active %}
                            <span class="badge bg-success">Activo</span>
                            {% else %}
                            <span class="badge bg-danger">Inactivo</span>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <strong>Tipo:</strong>
                            {% if role.is_system_role %}
                            <span class="badge bg-info">Rol del Sistema</span>
                            {% else %}
                            <span class="badge bg-secondary">Rol Personalizado</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Usuarios asignados:</strong>
                            <span class="badge bg-primary">{{ role.users.count }}</span>
                        </div>
                        <div class="col-md-6">
                            <strong>Permisos asignados:</strong>
                            <span class="badge bg-secondary">{{ role.permissions.count }}</span>
                        </div>
                    </div>

                    <hr>

                    <h4 class="mb-3">Permisos del Rol</h4>

                    <div class="d-flex flex-wrap gap-3 mb-4">
                        {% for module_key, module_data in permissions_matrix.items %}
                        <div class="card shadow-sm flex-fill" style="min-width: 300px; border: 1px solid #e3e6f0;">
                            <div class="card-header bg-light py-2 border-bottom">
                                <h6 class="m-0 font-weight-bold text-primary text-uppercase"
                                    style="font-size: 0.85rem;">
                                    <i class="fas fa-layer-group me-1"></i> {{ module_data.name }}
                                </h6>
                            </div>
                            <div class="card-body p-3">
                                <div class="d-flex flex-wrap gap-2" style="gap: 10px;">
                                    {% for perm_data in module_data.vals %}
                                    <div class="flex-fill p-2 rounded text-center border"
                                        style="min-width: 120px; background-color: {% if perm_data.has_perm %}#f0fdf4{% else %}#fef2f2{% endif %}; border-color: {% if perm_data.has_perm %}#bbf7d0{% else %}#fecaca{% endif %} !important;">
                                        <div class="font-weight-bold mb-1"
                                            style="color: {% if perm_data.has_perm %}#166534{% else %}#991b1b{% endif %};">
                                            {{ perm_data.permission.get_action_display }}
                                        </div>
                                        {% if perm_data.has_perm %}
                                        <span class="badge bg-success" style="font-size: 0.7rem;">
                                            <i class="fas fa-check-circle me-1"></i>Concedido
                                        </span>
                                        {% else %}
                                        <span class="badge bg-danger" style="font-size: 0.7rem;">
                                            <i class="fas fa-times-circle me-1"></i>Denegado
                                        </span>
                                        {% endif %}
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="w-100">
                            <div class="alert alert-info">
                                No se encontraron definiciones de permisos.
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <hr>

                    <div class="d-flex gap-2">
                        <a href="{% url 'role_permissions' role.pk %}" class="btn btn-warning">
                            <i class="fas fa-key"></i> Gestionar Permisos
                        </a>
                        <a href="{% url 'role_edit' role.pk %}" class="btn btn-primary">
                            <i class="fas fa-edit"></i> Editar
                        </a>
                        <a href="{% url 'role_list' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Volver
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}