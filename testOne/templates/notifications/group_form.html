{% extends 'base.html' %}
{% load static %}

{% block title %}SST - {% if form.instance.pk %}Editar{% else %}Crear{% endif %} Grupo{% endblock %}

{% block header_title %}Gestión de Grupos de Notificación{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1 style="font-size: 1.5rem; font-weight: 700;">
        {% if form.instance.pk %}Editar{% else %}Nuevo{% endif %} Grupo
    </h1>
    <a href="{% url 'notification_group_list' %}" class="btn-link">
        <i class="fas fa-arrow-left"></i> Volver al listado
    </a>
</div>

<div class="card" style="max-width: 800px; margin: 0 auto;">
    <form method="post" novalidate>
        {% csrf_token %}

        <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
            <!-- Nombre -->
            <div class="form-group">
                <label for="{{ form.name.id_for_label }}" style="font-weight: 600;">{{ form.name.label }}</label>
                {{ form.name }}
                {% if form.name.errors %}
                <div style="color: #dc3545; font-size: 0.8rem; margin-top: 5px;">
                    {{ form.name.errors.0 }}
                </div>
                {% endif %}
            </div>

            <!-- Descripción -->
            <div class="form-group">
                <label for="{{ form.description.id_for_label }}" style="font-weight: 600;">
                    {{ form.description.label }}</label>
                {{ form.description }}
                {% if form.description.errors %}
                <div style="color: #dc3545; font-size: 0.8rem; margin-top: 5px;">
                    {{ form.description.errors.0 }}
                </div>
                {% endif %}
            </div>

            <!-- Estado Activo -->
            <style>
                .checkbox-wrapper {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    padding: 12px;
                    background-color: #f8f9fa;
                    border-radius: 8px;
                    border: 1px solid #e9ecef;
                }

                .checkbox-wrapper input[type="checkbox"] {
                    width: 18px;
                    height: 18px;
                    cursor: pointer;
                    margin: 0;
                }

                .checkbox-wrapper label {
                    margin: 0;
                    font-weight: 500;
                    cursor: pointer;
                    color: #333;
                }
            </style>
            <div class="form-group">
                <div class="checkbox-wrapper">
                    {{ form.is_active }}
                    <label for="{{ form.is_active.id_for_label }}">
                        {{ form.is_active.label }}
                    </label>
                </div>
            </div>

            <!-- Usuarios -->
            <div class="form-group">
                <label
                    style="font-weight: 600; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    {{ form.users.label }}
                    <span
                        style="font-weight: 400; font-size: 0.8rem; color: #666; background: #eee; padding: 4px 10px; border-radius: 20px;">
                        Selección Múltiple
                    </span>
                </label>
                <div
                    style="border: 1px solid #ced4da; border-radius: 8px; padding: 15px; max-height: 300px; overflow-y: auto; background: #fff;">
                    {{ form.users }}
                </div>
                <small style="color: var(--text-light); display: block; margin-top: 8px;">
                    <i class="fas fa-info-circle"></i> Seleccione los usuarios que formarán parte de este grupo de
                    notificación.
                </small>
            </div>
        </div>

        <!-- Botones de Acción -->
        <div
            style="margin-top: 32px; display: flex; justify-content: flex-end; gap: 12px; border-top: 1px solid #eee; padding-top: 24px;">
            <a href="{% url 'notification_group_list' %}" class="btn"
                style="background: #e9ecef; color: #495057; text-decoration: none; padding: 10px 20px; border-radius: 6px; border: 1px solid #dee2e6;">
                Cancelar
            </a>
            <button type="submit" class="btn btn-primary" style="padding: 10px 24px;">
                <i class="fas fa-save" style="margin-right: 8px;"></i> Guardar Grupo
            </button>
        </div>
    </form>
</div>

<style>
    /* Estilos específicos para la lista de usuarios (CheckboxSelectMultiple) */
    #id_users {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 12px;
    }

    #id_users li {
        margin: 0;
    }

    #id_users li label {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 12px;
        border: 1px solid #eee;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
        background-color: #fff;
        height: 100%;
        margin: 0;
        /* Override default label margin */
        color: #495057;
    }

    #id_users li label:hover {
        background-color: #f8f9fa;
        border-color: #cbd5e1;
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    #id_users input[type="checkbox"] {
        margin: 0;
        width: 16px;
        height: 16px;
        accent-color: #49BAA0;
        /* Color primario del tema */
    }

    /* Input styles override to match user form */
    .form-control {
        display: block;
        width: 100%;
        padding: 0.375rem 0.75rem;
        font-size: 1rem;
        line-height: 1.5;
        color: #495057;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid #ced4da;
        border-radius: 0.25rem;
        transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
    }

    .form-control:focus {
        border-color: #80bdff;
        outline: 0;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, .25);
    }

    textarea.form-control {
        min-height: 100px;
    }
</style>
{% endblock %}